(function(f){var a=typeof self=="object"&&self.self==self&&self||typeof global=="object"&&global.global==global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(e,h,g){a.Backbone=f(a,g,e,h)})}else{if(typeof exports!=="undefined"){var b=require("underscore"),d;try{d=require("jquery")}catch(c){}f(a,exports,b,d)}else{a.Backbone=f(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}}})(function(aw,W,ad,ar){var ak=aw.Backbone;var au=Array.prototype.slice;W.VERSION="1.2.3";W.$=ar;W.noConflict=function(){aw.Backbone=ak;return this};W.emulateHTTP=false;W.emulateJSON=false;var G=function(c,a,b){switch(c){case 1:return function(){return ad[a](this[b])};case 2:return function(d){return ad[a](this[b],d)};case 3:return function(e,d){return ad[a](this[b],ab(e,this),d)};case 4:return function(f,d,e){return ad[a](this[b],ab(f,this),d,e)};default:return function(){var d=au.call(arguments);d.unshift(this[b]);return ad[a].apply(ad,d)}}};var am=function(c,a,b){ad.each(a,function(d,f){if(ad[f]){c.prototype[f]=G(d,f,b)}})};var ab=function(b,a){if(ad.isFunction(b)){return b}if(ad.isObject(b)&&!a._isModel(b)){return ay(b)}if(ad.isString(b)){return function(c){return c.get(b)}}return b};var ay=function(b){var a=ad.matches(b);return function(c){return a(c.attributes)}};var ah=W.Events={};var L=/\s+/;var Y=function(i,c,g,d,h){var b=0,f;if(g&&typeof g==="object"){if(d!==void 0&&"context" in h&&h.context===void 0){h.context=d}for(f=ad.keys(g);b<f.length;b++){c=Y(i,c,f[b],g[f[b]],h)}}else{if(g&&L.test(g)){for(f=g.split(L);b<f.length;b++){c=i(c,f[b],d,h)}}else{c=i(c,g,d,h)}}return c};ah.on=function(c,a,b){return V(this,c,a,b)};var V=function(g,a,b,d,c){g._events=Y(aA,g._events||{},a,b,{context:d,ctx:g,listening:c});if(c){var f=g._listeners||(g._listeners={});f[c.id]=c}return g};ah.listenTo=function(i,c,g){if(!i){return this}var d=i._listenId||(i._listenId=ad.uniqueId("l"));var h=this._listeningTo||(this._listeningTo={});var b=h[d];if(!b){var f=this._listenId||(this._listenId=ad.uniqueId("l"));b=h[d]={obj:i,objId:d,id:f,listeningTo:h,count:0}}V(i,c,g,this,b);return this};var aA=function(k,c,d,h){if(d){var f=k[c]||(k[c]=[]);var j=h.context,b=h.ctx,g=h.listening;if(g){g.count++}f.push({callback:d,context:j,ctx:j||b,listening:g})}return k};ah.off=function(c,a,b){if(!this._events){return this}this._events=Y(aa,this._events,c,a,{context:b,listeners:this._listeners});return this};ah.stopListening=function(i,c,g){var d=this._listeningTo;if(!d){return this}var h=i?[i._listenId]:ad.keys(d);for(var b=0;b<h.length;b++){var f=d[h[b]];if(!f){break}f.obj.off(c,g,this)}if(ad.isEmpty(d)){this._listeningTo=void 0}return this};var aa=function(z,j,x,q){if(!z){return}var y=0,b;var w=q.context,m=q.listeners;if(!j&&!x&&!w){var A=ad.keys(m);for(;y<A.length;y++){b=m[A[y]];delete m[b.id];delete b.listeningTo[b.objId]}return}var p=j?[j]:ad.keys(z);for(;y<p.length;y++){j=p[y];var g=z[j];if(!g){break}var k=[];for(var i=0;i<g.length;i++){var C=g[i];if(x&&x!==C.callback&&x!==C.callback._callback||w&&w!==C.context){k.push(C)}else{b=C.listening;if(b&&--b.count===0){delete m[b.id];delete b.listeningTo[b.objId]}}}if(k.length){z[j]=k}else{delete z[j]}}if(ad.size(z)){return z}};ah.once=function(d,a,c){var b=Y(ao,{},d,a,ad.bind(this.off,this));return this.on(b,void 0,c)};ah.listenToOnce=function(d,a,c){var b=Y(ao,{},a,c,ad.bind(this.stopListening,this,d));return this.listenTo(d,b)};var ao=function(f,a,c,b){if(c){var d=f[a]=ad.once(function(){b(a,d);c.apply(this,arguments)});d._callback=c}return f};ah.trigger=function(d){if(!this._events){return this}var a=Math.max(0,arguments.length-1);var b=Array(a);for(var c=0;c<a;c++){b[c]=arguments[c+1]}Y(ai,this._events,d,void 0,b);return this};var ai=function(g,a,b,d){if(g){var c=g[a];var f=g.all;if(c&&f){f=f.slice()}if(c){D(c,d)}if(f){D(f,[a].concat(d))}}return g};var D=function(k,c){var d,h=-1,f=k.length,j=c[0],b=c[1],g=c[2];switch(c.length){case 0:while(++h<f){(d=k[h]).callback.call(d.ctx)}return;case 1:while(++h<f){(d=k[h]).callback.call(d.ctx,j)}return;case 2:while(++h<f){(d=k[h]).callback.call(d.ctx,j,b)}return;case 3:while(++h<f){(d=k[h]).callback.call(d.ctx,j,b,g)}return;default:while(++h<f){(d=k[h]).callback.apply(d.ctx,c)}return}};ah.bind=ah.on;ah.unbind=ah.off;ad.extend(W,ah);var aD=W.Model=function(c,a){var b=c||{};a||(a={});this.cid=ad.uniqueId(this.cidPrefix);this.attributes={};if(a.collection){this.collection=a.collection}if(a.parse){b=this.parse(b,a)||{}}b=ad.defaults({},b,ad.result(this,"defaults"));this.set(b,a);this.changed={};this.initialize.apply(this,arguments)};ad.extend(aD.prototype,ah,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(a){return ad.clone(this.attributes)},sync:function(){return W.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return ad.escape(this.get(a))},has:function(a){return this.get(a)!=null},matches:function(a){return !!ad.iteratee(a,this)(this.attributes)},set:function(y,j,w){if(y==null){return this}var q;if(typeof y==="object"){q=y;w=j}else{(q={})[y]=j}w||(w={});if(!this._validate(q,w)){return false}var x=w.unset;var b=w.silent;var v=[];var m=this._changing;this._changing=true;if(!m){this._previousAttributes=ad.clone(this.attributes);this.changed={}}var z=this.attributes;var p=this.changed;var g=this._previousAttributes;for(var k in q){j=q[k];if(!ad.isEqual(z[k],j)){v.push(k)}if(!ad.isEqual(g[k],j)){p[k]=j}else{delete p[k]}x?delete z[k]:z[k]=j}this.id=this.get(this.idAttribute);if(!b){if(v.length){this._pending=w}for(var i=0;i<v.length;i++){this.trigger("change:"+v[i],this,z[v[i]],w)}}if(m){return this}if(!b){while(this._pending){w=this._pending;this._pending=false;this.trigger("change",this,w)}}this._pending=false;this._changing=false;return this},unset:function(b,a){return this.set(b,void 0,ad.extend({},a,{unset:true}))},clear:function(c){var a={};for(var b in this.attributes){a[b]=void 0}return this.set(a,ad.extend({},c,{unset:true}))},hasChanged:function(a){if(a==null){return !ad.isEmpty(this.changed)}return ad.has(this.changed,a)},changedAttributes:function(f){if(!f){return this.hasChanged()?ad.clone(this.changed):false}var a=this._changing?this._previousAttributes:this.attributes;var c={};for(var b in f){var d=f[b];if(ad.isEqual(a[b],d)){continue}c[b]=d}return ad.size(c)?c:false},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return ad.clone(this._previousAttributes)},fetch:function(c){c=ad.extend({parse:true},c);var a=this;var b=c.success;c.success=function(d){var e=c.parse?a.parse(d,c):d;if(!a.set(e,c)){return false}if(b){b.call(c.context,a,d,c)}a.trigger("sync",a,d,c)};aE(this,c);return this.sync("read",this,c)},save:function(m,c,j){var g;if(m==null||typeof m==="object"){g=m;j=c}else{(g={})[m]=c}j=ad.extend({validate:true,parse:true},j);var k=j.wait;if(g&&!k){if(!this.set(g,j)){return false}}else{if(!this._validate(g,j)){return false}}var b=this;var i=j.success;var d=this.attributes;j.success=function(h){b.attributes=d;var a=j.parse?b.parse(h,j):h;if(k){a=ad.extend({},g,a)}if(a&&!b.set(a,j)){return false}if(i){i.call(j.context,b,h,j)}b.trigger("sync",b,h,j)};aE(this,j);if(g&&k){this.attributes=ad.extend({},d,g)}var p=this.isNew()?"create":j.patch?"patch":"update";if(p==="patch"&&!j.attrs){j.attrs=g}var f=this.sync(p,this,j);this.attributes=d;return f},destroy:function(h){h=h?ad.clone(h):{};var c=this;var f=h.success;var d=h.wait;var g=function(){c.stopListening();c.trigger("destroy",c,c.collection,h)};h.success=function(a){if(d){g()}if(f){f.call(h.context,c,a,h)}if(!c.isNew()){c.trigger("sync",c,a,h)}};var b=false;if(this.isNew()){ad.defer(h.success)}else{aE(this,h);b=this.sync("delete",this,h)}if(!d){g()}return b},url:function(){var b=ad.result(this,"urlRoot")||ad.result(this.collection,"url")||Z();if(this.isNew()){return b}var a=this.get(this.idAttribute);return b.replace(/[^\/]$/,"$&/")+encodeURIComponent(a)},parse:function(b,a){return b},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},ad.defaults({validate:true},a))},_validate:function(c,a){if(!a.validate||!this.validate){return true}c=ad.extend({},this.attributes,c);var b=this.validationError=this.validate(c,a)||null;if(!b){return true}this.trigger("invalid",this,b,ad.extend(a,{validationError:b}));return false}});var K={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};am(aD,K,"attributes");var aC=W.Collection=function(b,a){a||(a={});if(a.model){this.model=a.model}if(a.comparator!==void 0){this.comparator=a.comparator}this._reset();this.initialize.apply(this,arguments);if(b){this.reset(b,ad.extend({silent:true},a))}};var aB={add:true,remove:true,merge:true};var X={add:true,remove:false};var ag=function(g,a,b){b=Math.min(Math.max(b,0),g.length);var d=Array(g.length-b);var c=a.length;for(var f=0;f<d.length;f++){d[f]=g[f+b]}for(f=0;f<c;f++){g[f+b]=a[f]}for(f=0;f<d.length;f++){g[f+c+b]=d[f]}};ad.extend(aC.prototype,ah,{model:aD,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return W.sync.apply(this,arguments)},add:function(b,a){return this.set(b,ad.extend({merge:false},a,X))},remove:function(d,a){a=ad.extend({},a);var c=!ad.isArray(d);d=c?[d]:ad.clone(d);var b=this._removeModels(d,a);if(!a.silent&&b){this.trigger("update",this,a)}return c?b[0]:b},set:function(P,x){if(P==null){return}x=ad.defaults({},x,aB);if(x.parse&&!this._isModel(P)){P=this.parse(P,x)}var N=!ad.isArray(P);P=N?[P]:P.slice();var H=x.at;if(H!=null){H=+H}if(H<0){H+=this.length+1}var O=[];var j=[];var I=[];var C={};var R=x.add;var E=x.merge;var q=x.remove;var z=false;var w=this.comparator&&H==null&&x.sort!==false;var S=ad.isString(this.comparator)?this.comparator:null;var A;for(var M=0;M<P.length;M++){A=P[M];var F=this.get(A);if(F){if(E&&A!==F){var i=this._isModel(A)?A.attributes:A;if(x.parse){i=F.parse(i,x)}F.set(i,x);if(w&&!z){z=F.hasChanged(S)}}if(!C[F.cid]){C[F.cid]=true;O.push(F)}P[M]=F}else{if(R){A=P[M]=this._prepareModel(A,x);if(A){j.push(A);this._addReference(A,x);C[A.cid]=true;O.push(A)}}}}if(q){for(M=0;M<this.length;M++){A=this.models[M];if(!C[A.cid]){I.push(A)}}if(I.length){this._removeModels(I,x)}}var T=false;var k=!w&&R&&q;if(O.length&&k){T=this.length!=O.length||ad.some(this.models,function(b,a){return b!==O[a]});this.models.length=0;ag(this.models,O,0);this.length=this.models.length}else{if(j.length){if(w){z=true}ag(this.models,j,H==null?this.length:H);this.length=this.models.length}}if(z){this.sort({silent:true})}if(!x.silent){for(M=0;M<j.length;M++){if(H!=null){x.index=H+M}A=j[M];A.trigger("add",A,this,x)}if(z||T){this.trigger("sort",this,x)}if(j.length||I.length){this.trigger("update",this,x)}}return N?P[0]:P},reset:function(c,a){a=a?ad.clone(a):{};for(var b=0;b<this.models.length;b++){this._removeReference(this.models[b],a)}a.previousModels=this.models;this._reset();c=this.add(c,ad.extend({silent:true},a));if(!a.silent){this.trigger("reset",this,a)}return c},push:function(b,a){return this.add(b,ad.extend({at:this.length},a))},pop:function(b){var a=this.at(this.length-1);return this.remove(a,b)},unshift:function(b,a){return this.add(b,ad.extend({at:0},a))},shift:function(b){var a=this.at(0);return this.remove(a,b)},slice:function(){return au.apply(this.models,arguments)},get:function(b){if(b==null){return void 0}var a=this.modelId(this._isModel(b)?b.attributes:b);return this._byId[b]||this._byId[a]||this._byId[b.cid]},at:function(a){if(a<0){a+=this.length}return this.models[a]},where:function(b,a){return this[a?"find":"filter"](b)},findWhere:function(a){return this.where(a,true)},sort:function(c){var a=this.comparator;if(!a){throw new Error("Cannot sort a set without a comparator")}c||(c={});var b=a.length;if(ad.isFunction(a)){a=ad.bind(a,this)}if(b===1||ad.isString(a)){this.models=this.sortBy(a)}else{this.models.sort(a)}if(!c.silent){this.trigger("sort",this,c)}return this},pluck:function(a){return ad.invoke(this.models,"get",a)},fetch:function(c){c=ad.extend({parse:true},c);var a=c.success;var b=this;c.success=function(d){var e=c.reset?"reset":"set";b[e](d,c);if(a){a.call(c.context,b,d,c)}b.trigger("sync",b,d,c)};aE(this,c);return this.sync("read",this,c)},create:function(f,a){a=a?ad.clone(a):{};var c=a.wait;f=this._prepareModel(f,a);if(!f){return false}if(!c){this.add(f,a)}var b=this;var d=a.success;a.success=function(j,g,h){if(c){b.add(j,h)}if(d){d.call(h.context,j,g,h)}};f.save(null,a);return f},parse:function(b,a){return b},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(c,a){if(this._isModel(c)){if(!c.collection){c.collection=this}return c}a=a?ad.clone(a):{};a.collection=this;var b=new this.model(c,a);if(!b.validationError){return b}this.trigger("invalid",this,b.validationError,a);return false},_removeModels:function(g,a){var b=[];for(var d=0;d<g.length;d++){var c=this.get(g[d]);if(!c){continue}var f=this.indexOf(c);this.models.splice(f,1);this.length--;if(!a.silent){a.index=f;c.trigger("remove",c,this,a)}b.push(c);this._removeReference(c,a)}return b.length?b:false},_isModel:function(a){return a instanceof aD},_addReference:function(c,a){this._byId[c.cid]=c;var b=this.modelId(c.attributes);if(b!=null){this._byId[b]=c}c.on("all",this._onModelEvent,this)},_removeReference:function(c,a){delete this._byId[c.cid];var b=this.modelId(c.attributes);if(b!=null){delete this._byId[b]}if(this===c.collection){delete c.collection}c.off("all",this._onModelEvent,this)},_onModelEvent:function(g,a,b,d){if((g==="add"||g==="remove")&&b!==this){return}if(g==="destroy"){this.remove(a,d)}if(g==="change"){var c=this.modelId(a.previousAttributes());var f=this.modelId(a.attributes);if(c!==f){if(c!=null){delete this._byId[c]}if(f!=null){this._byId[f]=a}}}this.trigger.apply(this,arguments)}});var av={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};am(aC,av,"models");var ae=W.View=function(a){this.cid=ad.uniqueId("view");ad.extend(this,ad.pick(a,ap));this._ensureElement();this.initialize.apply(this,arguments)};var ax=/^(\S+)\s*(.*)$/;var ap=["model","collection","el","id","attributes","className","tagName","events"];ad.extend(ae.prototype,ah,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(a){this.undelegateEvents();this._setElement(a);this.delegateEvents();return this},_setElement:function(a){this.$el=a instanceof W.$?a:W.$(a);this.el=this.$el[0]},delegateEvents:function(d){d||(d=ad.result(this,"events"));if(!d){return this}this.undelegateEvents();for(var a in d){var c=d[a];if(!ad.isFunction(c)){c=this[c]}if(!c){continue}var b=a.match(ax);this.delegate(b[1],b[2],ad.bind(c,this))}return this},delegate:function(c,a,b){this.$el.on(c+".delegateEvents"+this.cid,a,b);return this},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(c,a,b){this.$el.off(c+".delegateEvents"+this.cid,a,b);return this},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(!this.el){var a=ad.extend({},ad.result(this,"attributes"));if(this.id){a.id=ad.result(this,"id")}if(this.className){a["class"]=ad.result(this,"className")}this.setElement(this._createElement(ad.result(this,"tagName")));this._setAttributes(a)}else{this.setElement(ad.result(this,"el"))}},_setAttributes:function(a){this.$el.attr(a)}});W.sync=function(i,f,d){var g=ac[i];ad.defaults(d||(d={}),{emulateHTTP:W.emulateHTTP,emulateJSON:W.emulateJSON});var b={type:g,dataType:"json"};if(!d.url){b.url=ad.result(f,"url")||Z()}if(d.data==null&&f&&(i==="create"||i==="update"||i==="patch")){b.contentType="application/json";b.data=JSON.stringify(d.attrs||f.toJSON(d))}if(d.emulateJSON){b.contentType="application/x-www-form-urlencoded";b.data=b.data?{model:b.data}:{}}if(d.emulateHTTP&&(g==="PUT"||g==="DELETE"||g==="PATCH")){b.type="POST";if(d.emulateJSON){b.data._method=g}var e=d.beforeSend;d.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g);if(e){return e.apply(this,arguments)}}}if(b.type!=="GET"&&!d.emulateJSON){b.processData=false}var c=d.error;d.error=function(k,a,h){d.textStatus=a;d.errorThrown=h;if(c){c.call(d.context,k,a,h)}};var j=d.xhr=W.ajax(ad.extend(b,d));f.trigger("request",f,j,d);return j};var ac={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};W.ajax=function(){return W.$.ajax.apply(W.$,arguments)};var B=W.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var J=/\((.*?)\)/g;var Q=/(\(\?)?:\w+/g;var at=/\*\w+/g;var af=/[\-{}\[\]+?.,\\\^$|#\s]/g;ad.extend(B.prototype,ah,{initialize:function(){},route:function(d,b,a){if(!ad.isRegExp(d)){d=this._routeToRegExp(d)}if(ad.isFunction(b)){a=b;b=""}if(!a){a=this[b]}var c=this;W.history.route(d,function(f){var e=c._extractParameters(d,f);if(c.execute(a,e,b)!==false){c.trigger.apply(c,["route:"+b].concat(e));c.trigger("route",b,e);W.history.trigger("route",c,b,e)}});return this},execute:function(c,a,b){if(c){c.apply(this,a)}},navigate:function(b,a){W.history.navigate(b,a);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=ad.result(this,"routes");var b,a=ad.keys(this.routes);while((b=a.pop())!=null){this.route(b,this.routes[b])}},_routeToRegExp:function(a){a=a.replace(af,"\\$&").replace(J,"(?:$1)?").replace(Q,function(c,b){return b?c:"([^/?]+)"}).replace(at,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(c,a){var b=c.exec(a).slice(1);return ad.map(b,function(f,d){if(d===b.length-1){return f||null}return f?decodeURIComponent(f):null})}});var aj=W.History=function(){this.handlers=[];this.checkUrl=ad.bind(this.checkUrl,this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var al=/^[#\/]|\s+$/g;var an=/^\/+|\/+$/g;var az=/#.*$/;aj.started=false;ad.extend(aj.prototype,ah,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},matchRoot:function(){var b=this.decodeFragment(this.location.pathname);var a=b.slice(0,this.root.length-1)+"/";return a===this.root},decodeFragment:function(a){return decodeURI(a.replace(/%25/g,"%2525"))},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(b){var a=(b||this).location.href.match(/#(.*)$/);return a?a[1]:""},getPath:function(){var a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return a.charAt(0)==="/"?a.slice(1):a},getFragment:function(a){if(a==null){if(this._usePushState||!this._wantsHashChange){a=this.getPath()}else{a=this.getHash()}}return a.replace(al,"")},start:function(f){if(aj.started){throw new Error("Backbone.history has already been started")}aj.started=true;this.options=ad.extend({root:"/"},this.options,f);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange" in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(an,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var a=this.root.slice(0,-1)||"/";this.location.replace(a+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var c=document.body;var b=c.insertBefore(this.iframe,c.firstChild).contentWindow;b.document.open();b.document.close();b.location.hash="#"+this.fragment}var d=window.addEventListener||function(h,g){return attachEvent("on"+h,g)};if(this._usePushState){d("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){d("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var a=window.removeEventListener||function(c,b){return detachEvent("on"+c,b)};if(this._usePushState){a("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){a("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}aj.started=false},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(b){var a=this.getFragment();if(a===this.fragment&&this.iframe){a=this.getHash(this.iframe.contentWindow)}if(a===this.fragment){return false}if(this.iframe){this.navigate(a)}this.loadUrl()},loadUrl:function(a){if(!this.matchRoot()){return false}a=this.fragment=this.getFragment(a);return ad.some(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(f,a){if(!aj.started){return false}if(!a||a===true){a={trigger:!!a}}f=this.getFragment(f||"");var b=this.root;if(f===""||f.charAt(0)==="?"){b=b.slice(0,-1)||"/"}var d=b+f;f=this.decodeFragment(f.replace(az,""));if(this.fragment===f){return}this.fragment=f;if(this._usePushState){this.history[a.replace?"replaceState":"pushState"]({},document.title,d)}else{if(this._wantsHashChange){this._updateHash(this.location,f,a.replace);if(this.iframe&&f!==this.getHash(this.iframe.contentWindow)){var c=this.iframe.contentWindow;if(!a.replace){c.document.open();c.document.close()}this._updateHash(c.location,f,a.replace)}}else{return this.location.assign(d)}}if(a.trigger){return this.loadUrl(f)}},_updateHash:function(d,a,b){if(b){var c=d.href.replace(/(javascript:|#).*$/,"");d.replace(c+"#"+a)}else{d.hash="#"+a}}});W.history=new aj;var aq=function(f,a){var c=this;var b;if(f&&ad.has(f,"constructor")){b=f.constructor}else{b=function(){return c.apply(this,arguments)}}ad.extend(b,c,a);var d=function(){this.constructor=b};d.prototype=c.prototype;b.prototype=new d;if(f){ad.extend(b.prototype,f)}b.__super__=c.prototype;return b};aD.extend=aC.extend=B.extend=ae.extend=aj.extend=aq;var Z=function(){throw new Error('A "url" property or function must be specified')};var aE=function(c,a){var b=a.error;a.error=function(d){if(b){b.call(a.context,c,d,a)}c.trigger("error",c,d,a)}};return W});